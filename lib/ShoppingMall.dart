import 'dart:io';
import 'dart:convert';
import 'package:dart_shopping_mall_code/Product.dart';

// - **ì†ì„±**
//     - íŒë§¤í•˜ëŠ” ìƒí’ˆ ëª©ë¡ (`List<Product>`)
//     - ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆë“¤ì˜ ì´ ê°€ê²© (`int`)
// - **ë©”ì„œë“œ**
//     - ìƒí’ˆ ëª©ë¡ì„ ì¶œë ¥í•˜ëŠ” ë©”ì„œë“œ (`showProducts()`)
//     - ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ëŠ” ë©”ì„œë“œ (`addToCart()`)
// - ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆì˜ ì´ ê°€ê²©ì„ ì¶œë ¥í•˜ëŠ” ë©”ì„œë“œ (`showTotal()`)

class ShoppingMall {
  final List<Product> products;
  // final int productcount = products.length;

  ShoppingMall({required this.products});

  void run() {
    while (true) {
      _showmenu();
      final input = stdin.readLineSync(encoding: utf8);

      switch (input) {
        case "1":
          print('$inputì„ ì„ íƒ í•˜ì…¨ìŠµë‹ˆë‹¤ ìƒí’ˆëª©ë¡ì„ ë¶ˆëŸ¬ ì˜µë‹ˆë‹¤.');
          showProducts();
          break;
        //[1] ìƒí’ˆ ëª©ë¡ ë³´ê¸°
        case "2":
          print('$inputì„ ì„ íƒ í•˜ì…¨ìŠµë‹ˆë‹¤ ì‚¼í’ˆì„ ë‹´ê¸° ìœ„í•´ ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•©ë‹ˆë‹¤.');
          addToCart();
          break;
        // [2] ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
        case "3":
          print('$inputì„ ì„ íƒ í•˜ì…¨ìŠµë‹ˆë‹¤ ì‚¼í’ˆì„ ë‹´ê¸° ìœ„í•´ ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•©ë‹ˆë‹¤.');
          showTotal();
          break;
        // [3] ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆì˜ ì´ ê°€ê²© ë³´ê¸°
        case "4":
          showEnd();
          break;
        // [4] í”„ë¡œê·¸ë¨ ì¢…ë£Œ
        case "6":
          clearCart();
          break;
        // [6] ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
        default:
          print('ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤ ! ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš” ..');
          break;
      }
    }
  }
}

//   - ìƒí’ˆ ëª©ë¡ì„ ì¶œë ¥í•˜ëŠ” ë©”ì„œë“œ (`showProducts()`)
// - ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ëŠ” ë©”ì„œë“œ (`addToCart()`)
// - ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆì˜ ì´ ê°€ê²©ì„ ì¶œë ¥í•˜ëŠ” ë©”ì„œë“œ (`showTotal()`)
void _showmenu() {
  print(
    '-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------',
  );

  stdout.write(
    '[1] ìƒí’ˆ ëª©ë¡ ë³´ê¸° / [2] ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸° / [3] ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆì˜ ì´ ê°€ê²© ë³´ê¸° / [4] í”„ë¡œê·¸ë¨ ì¢…ë£Œ / [6] ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°\n', //---ì„ í™”ë©´ì— ë§ì¶°ì„œ ì¶œë ¥ì´ ì•ˆë˜ì„œ ì•„ì‰¬ì›€
  );

  print(
    '-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------',
  );
}

showProducts() {
  print('1ë²ˆì„ ì…ë ¥ ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.');
  print('---------------------ğŸ›ï¸ìƒí’ˆ ëª©ë¡ğŸ›ï¸----------------------');
  for (var Product in products) {
    print('${Product.goods} / ${Product.price}ì›');
    print('-----------------------------------------------------\n');
  }
}

// final Map<String, int> cart = {}; ë§Œë“¤ë‹¤ë³´ë‹ˆ ê²°êµ­ ì•ˆì»ë‹¤..

int totalPrice = 0;

void addToCart() {
  print('2ë²ˆì„ ì…ë ¥ ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•©ë‹ˆë‹¤.');
  print('\n-------- ğŸ›’ì¥ë°”êµ¬ë‹ˆğŸ›’ --------');
  print('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìƒí’ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
  final String? goodsInput = stdin.readLineSync(encoding: utf8);

  // ì…ë ¥ê°’ì´ nullì´ê±°ë‚˜ ë¹„ì–´ìˆëŠ” ê²½ìš°ë„ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ìœ¼ë¡œ ì²˜ë¦¬
  if (goodsInput == null || goodsInput.isEmpty) {
    print('ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš” !');
    return;
  }

  // ê³ ì°¨ í•¨ìˆ˜ any()ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒë³„
  if (products.any((product) => product.goods == goodsInput) == false) {
    print('ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš” !');
    return;
  }

  print('ìƒí’ˆì˜ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
  final String? quantityInput = stdin.readLineSync(encoding: utf8);

  if (quantityInput == null || quantityInput.isEmpty) {
    print('ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš” !');
    return;
  }

  try {
    final int quantity = int.parse(quantityInput);

    if (quantity <= 0) {
      //ê°œìˆ˜ê°€ 0ì´ë‚˜ ë”ì‘ì€ì§€ í™•ì¸í•˜ê³  0ì´ë‚˜ ë”ì‘ìœ¼ë©´ ë©”ì‹œì§€ ì¶œë ¥
      print('0ê°œë³´ë‹¤ ë§ì€ ê°œìˆ˜ì˜ ìƒí’ˆë§Œ ë‹´ì„ ìˆ˜ ìˆì–´ìš” !');
      return;
    }

    // 1. í•´ë‹¹ ìƒí’ˆì˜ ë‹¨ê°€ ì°¾ê¸° (firstWhere ì‚¬ìš©)
    final product = products.firstWhere((p) => p.goods == goodsInput);
    // 2. ì´ì•¡ì— (ë‹¨ê°€ * ìˆ˜ëŸ‰) ë”í•˜ê¸°
    totalPrice += product.price * quantity;

    print('ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì´ ë‹´ê²¼ì–´ìš” !');
  } on FormatException {
    print('ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš” !');
  }
}

showTotal() {
  print('3ë²ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ë¬¼ê±´ì˜ í•©ì„ ì¶œë ¥í•©ë‹ˆë‹¤.');
  print('\n----- ğŸ›’ì¥ë°”êµ¬ë‹ˆğŸ›’ -----');
  print('ì¥ë°”êµ¬ë‹ˆì— $totalPriceì› ì–´ì¹˜ë¥¼ ë‹´ìœ¼ì…¨ë„¤ìš” ! ');
}

void clearCart() {
  print('6ë²ˆì„ ì…ë ¥ ì¥ë°”êµ¬ë‹ˆë¥¼ ë¹„ì›ë‹ˆë‹¤.');
  if (totalPrice == 0) {
    //ì¡°ê±´ í† íƒˆí”„ë¼ì´ìŠ¤ ê°€ 0ì¸ì§€ í™•ì¸í•´ì„œ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
    print('ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
  } else {
    cart.clear();
    totalPrice = 0; //0ìœ¼ë¡œ ì´ˆê¸°í™”
    print('ì¥ë°”êµ¬ë‹ˆë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
  }
}

showEnd() {
  print('ì •ë§ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
  var endinput = stdin.readLineSync();
  if (endinput == "5") {
    //5ì…ë ¥ í–ˆëŠ”ì§€ í™•ì¸
    print('ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ~ ì•ˆë…•íˆ ê°€ì„¸ìš”!');
    exit(0); // dart:ioì—ì„œ ì§€ì›í•˜ëŠ” ì¢…ë£Œ ëª…ë ¹ì–´
  } else {
    print('ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
}
